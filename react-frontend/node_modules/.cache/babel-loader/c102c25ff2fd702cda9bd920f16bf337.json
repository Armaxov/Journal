{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Arslan\\\\eclipse-workspace\\\\Journal\\\\react-frontend\\\\src\\\\components\\\\JournalDetailsComponent.jsx\";\nimport React, { Component } from 'react';\nimport JournalService from '../services/JournalService';\nimport GroupService from '../services/GroupService';\nimport MarkService from '../services/MarkService';\nimport LessonService from '../services/LessonService';\nimport StudentService from '../services/StudentService';\nimport AuthenticationService from '../services/AuthenticationService';\nimport UserService from '../services/UserService';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass JournalDetailsComponent extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      id: this.props.match.params.id,\n      journal: [],\n      groups: [],\n      marks: [],\n      lessons: [],\n      students: [],\n      sortedUsers: [],\n      sortedGroup: '',\n      userId: '',\n      canShowDeleteButton: false,\n      currentUserId: ''\n    };\n    this.changeDateHandler = this.changeDateHandler.bind(this);\n    this.changeMarkHandler = this.changeMarkHandler.bind(this);\n    this.changeDescriptionHandler = this.changeDescriptionHandler.bind(this);\n    this.addMarkHandler = this.addMarkHandler.bind(this);\n    this.addLessonHandler = this.addLessonHandler.bind(this);\n    this.deleteButtonHanlder = this.deleteButtonHanlder.bind(this);\n  }\n\n  componentDidMount() {\n    GroupService.getGroups().then(res => {\n      this.setState({\n        groups: res.data\n      });\n    });\n    MarkService.getMarks().then(res => {\n      this.setState({\n        marks: res.data\n      });\n    });\n    LessonService.getLessons().then(res => {\n      this.setState({\n        lessons: res.data\n      });\n    });\n    StudentService.getStudents().then(res => {\n      this.setState({\n        students: res.data\n      });\n    });\n    JournalService.getJournalById(this.state.id).then(res => {\n      this.setState({\n        journal: res.data,\n        userId: res.data.userId\n      });\n    }).then(() => {\n      let username = '';\n      AuthenticationService.getUsernameByToken().then(res => {\n        username = res.data;\n        let userId = '';\n        UserService.getIdByUsername(username).then(res2 => {\n          userId = res2.data;\n          this.setState({\n            currentUserId: userId\n          });\n\n          if (this.isHaveFullAccess(userId)) {\n            this.setState({\n              canShowDeleteButton: true\n            });\n          }\n        });\n      });\n    });\n  }\n\n  isHaveFullAccess(userId) {\n    if (userId != '' && userId == this.state.userId) return true;else return false;\n  }\n\n  getLessonByJournal() {\n    let result = [];\n    this.state.lessons.map(lesson => {\n      if (lesson.journalId == this.state.id) {\n        result.push(lesson);\n      }\n    });\n    return result;\n  }\n\n  getMarkByJournal(markId, studentId) {\n    let result = [];\n    this.state.marks.map(mark => {\n      if (mark.journalId == markId && mark.studentId == studentId) result.push(mark);\n    });\n    return result;\n  }\n\n  getAllJournalMarks() {\n    let result = [];\n    this.state.marks.map(mark => {\n      if (mark.journalId == this.id) result.push(mark);\n    });\n    return result;\n  }\n\n  getGroupById(journalId) {\n    let result = '';\n    this.state.groups.map(group => {\n      if (group.id == journalId) result = group;\n    });\n    this.state.sortedGroup = result;\n    return result;\n  }\n\n  getStudentsNameByGroup(group) {\n    let result = [];\n    this.state.students.map(student => {\n      if (student.groupId == group.id) result.push(student);\n    });\n    this.state.sortedUsers = result;\n    return result;\n  }\n\n  changeDateHandler(event, lesson) {\n    if (this.isHaveFullAccess(this.state.currentUserId)) lesson.date = event.target.value;\n    LessonService.updateLesson(lesson, lesson.id);\n    this.setState({});\n  }\n\n  changeMarkHandler(event, mark) {\n    mark.mark = event.target.value;\n    MarkService.updateMark(mark, mark.id);\n    this.setState({});\n  }\n\n  changeDescriptionHandler(event, lesson) {\n    lesson.description = event.target.value;\n    LessonService.updateLesson(lesson, lesson.id);\n    this.setState({});\n  }\n\n  addMarkHandler(student) {\n    let mark = {\n      studentId: student.id,\n      lessonId: '',\n      journalId: this.state.id,\n      mark: ''\n    };\n    MarkService.createMark(mark);\n    this.setState({});\n    document.location.reload();\n  }\n\n  addLessonHandler() {\n    let lesson = {\n      description: '',\n      date: '',\n      journalId: this.state.id\n    };\n    LessonService.createLesson(lesson).then(res => {\n      this.state.sortedUsers.map(student => {\n        let mark = {\n          studentId: student.id,\n          lessonId: res.data.id,\n          journalId: this.state.id,\n          mark: ''\n        };\n        MarkService.createMark(mark);\n      });\n      this.setState({});\n      document.location.reload();\n    });\n  }\n\n  deleteButtonHanlder() {\n    if (window.confirm(\"Вы действительно хотите удалить журнал?\")) {\n      this.getAllJournalMarks().map(mark => {\n        MarkService.deleteMark(mark.id);\n      });\n      this.getLessonByJournal(this.state.id).map(lesson => {\n        LessonService.deleteLesson(lesson.id);\n      });\n      JournalService.deleteJournal(this.state.id);\n    }\n\n    this.props.history.push(\"/journals\");\n    window.location.reload();\n  }\n\n  showRedactButton() {\n    if (AuthenticationService.isUserLoggedIn() && this.state.id != -1) {\n      return /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: e => this.editJournal(this.state.id),\n        children: \"\\u0418\\u0437\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C \\u0434\\u0430\\u043D\\u043D\\u044B\\u0435 \\u0436\\u0443\\u0440\\u043D\\u0430\\u043B\\u0430\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 20\n      }, this);\n    }\n  }\n\n  showDeleteButton() {\n    if (this.state.canShowDeleteButton) return /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"btn btn-danger\",\n      onClick: this.deleteButtonHanlder,\n      children: \"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C \\u0436\\u0443\\u0440\\u043D\\u0430\\u043B\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 20\n    }, this);\n  }\n\n  editJournal(id) {\n    this.props.history.push(`add-journal/${id}`);\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"text-center\",\n        children: \"\\u0421\\u043F\\u0438\\u0441\\u043E\\u043A \\u0441\\u0442\\u0443\\u0434\\u0435\\u043D\\u0442\\u043E\\u0432\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"py-3\",\n          children: [this.showRedactButton(), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"py-1\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 200,\n            columnNumber: 21\n          }, this), this.showDeleteButton()]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 198,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"table\", {\n          className: \"table table-striped table-bordered table-responsive\",\n          children: /*#__PURE__*/_jsxDEV(\"tbody\", {\n            children: [/*#__PURE__*/_jsxDEV(\"tr\", {\n              children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                width: \"5%\",\n                children: \"\\u2116\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 207,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                width: \"25%\",\n                children: \"\\u0424\\u0418\\u041E\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 208,\n                columnNumber: 33\n              }, this), this.getLessonByJournal().map(lesson => /*#__PURE__*/_jsxDEV(\"td\", {\n                children: /*#__PURE__*/_jsxDEV(\"input\", {\n                  value: lesson.date,\n                  onChange: e => {\n                    this.changeDateHandler(e, lesson);\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 211,\n                  columnNumber: 61\n                }, this)\n              }, lesson.id, false, {\n                fileName: _jsxFileName,\n                lineNumber: 211,\n                columnNumber: 41\n              }, this)), /*#__PURE__*/_jsxDEV(\"td\", {\n                onClick: this.addLessonHandler,\n                children: \"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0434\\u0430\\u0442\\u0443\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 213,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 206,\n              columnNumber: 29\n            }, this), this.getStudentsNameByGroup(this.getGroupById(this.state.journal.groupId)).map((student, index) => /*#__PURE__*/_jsxDEV(\"tr\", {\n              children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                children: index + 1\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 217,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: student.firstName + \" \" + student.lastName\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 218,\n                columnNumber: 33\n              }, this), this.getMarkByJournal(this.state.id, student.id).map(mark => /*#__PURE__*/_jsxDEV(\"td\", {\n                children: /*#__PURE__*/_jsxDEV(\"input\", {\n                  value: mark.mark,\n                  onChange: e => {\n                    this.changeMarkHandler(e, mark);\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 221,\n                  columnNumber: 59\n                }, this)\n              }, mark.id, false, {\n                fileName: _jsxFileName,\n                lineNumber: 221,\n                columnNumber: 41\n              }, this))]\n            }, student.id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 216,\n              columnNumber: 29\n            }, this)), /*#__PURE__*/_jsxDEV(\"tr\", {\n              children: [/*#__PURE__*/_jsxDEV(\"td\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 225,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: \"\\u0422\\u0435\\u043C\\u044B\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 226,\n                columnNumber: 33\n              }, this), this.getLessonByJournal().map(lesson => /*#__PURE__*/_jsxDEV(\"td\", {\n                children: /*#__PURE__*/_jsxDEV(\"input\", {\n                  value: lesson.description,\n                  onChange: e => {\n                    this.changeDescriptionHandler(e, lesson);\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 229,\n                  columnNumber: 61\n                }, this)\n              }, lesson.id, false, {\n                fileName: _jsxFileName,\n                lineNumber: 229,\n                columnNumber: 41\n              }, this)), /*#__PURE__*/_jsxDEV(\"td\", {\n                onClick: this.addLessonHandler,\n                children: \"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0442\\u0435\\u043C\\u0443\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 231,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 224,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 205,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 203,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 197,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default JournalDetailsComponent;","map":{"version":3,"sources":["C:/Users/Arslan/eclipse-workspace/Journal/react-frontend/src/components/JournalDetailsComponent.jsx"],"names":["React","Component","JournalService","GroupService","MarkService","LessonService","StudentService","AuthenticationService","UserService","JournalDetailsComponent","constructor","props","state","id","match","params","journal","groups","marks","lessons","students","sortedUsers","sortedGroup","userId","canShowDeleteButton","currentUserId","changeDateHandler","bind","changeMarkHandler","changeDescriptionHandler","addMarkHandler","addLessonHandler","deleteButtonHanlder","componentDidMount","getGroups","then","res","setState","data","getMarks","getLessons","getStudents","getJournalById","username","getUsernameByToken","getIdByUsername","res2","isHaveFullAccess","getLessonByJournal","result","map","lesson","journalId","push","getMarkByJournal","markId","studentId","mark","getAllJournalMarks","getGroupById","group","getStudentsNameByGroup","student","groupId","event","date","target","value","updateLesson","updateMark","description","lessonId","createMark","document","location","reload","createLesson","window","confirm","deleteMark","deleteLesson","deleteJournal","history","showRedactButton","isUserLoggedIn","e","editJournal","showDeleteButton","render","index","firstName","lastName"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport JournalService from '../services/JournalService';\r\nimport GroupService from '../services/GroupService';\r\nimport MarkService from '../services/MarkService';\r\nimport LessonService from '../services/LessonService';\r\nimport StudentService from '../services/StudentService';\r\nimport AuthenticationService from '../services/AuthenticationService';\r\nimport UserService from '../services/UserService';\r\n\r\nclass JournalDetailsComponent extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            id: this.props.match.params.id,\r\n            journal:[],\r\n            groups:[],\r\n            marks:[],\r\n            lessons:[],\r\n            students:[],\r\n            sortedUsers:[],\r\n            sortedGroup: '',\r\n            userId: '',\r\n            canShowDeleteButton: false,\r\n            currentUserId: ''\r\n        }\r\n        this.changeDateHandler = this.changeDateHandler.bind(this);\r\n        this.changeMarkHandler = this.changeMarkHandler.bind(this);\r\n        this.changeDescriptionHandler = this.changeDescriptionHandler.bind(this);\r\n        this.addMarkHandler = this.addMarkHandler.bind(this);\r\n        this.addLessonHandler = this.addLessonHandler.bind(this);\r\n        this.deleteButtonHanlder = this.deleteButtonHanlder.bind(this);\r\n    }\r\n\r\n    componentDidMount(){\r\n        GroupService.getGroups().then((res) => {\r\n            this.setState({groups: res.data});\r\n        });\r\n        MarkService.getMarks().then((res) => {\r\n            this.setState({marks: res.data});\r\n        });\r\n        LessonService.getLessons().then((res) => {\r\n            this.setState({lessons: res.data});\r\n        });\r\n        StudentService.getStudents().then((res) => {\r\n            this.setState({students: res.data});\r\n        });\r\n        JournalService.getJournalById(this.state.id).then((res) => {\r\n            this.setState({journal: res.data, userId: res.data.userId});\r\n        }).then(() => {\r\n            let username = '';\r\n            AuthenticationService.getUsernameByToken().then(res => {\r\n            username = res.data;\r\n            let userId = '';\r\n            UserService.getIdByUsername(username).then(res2 =>{\r\n                userId = res2.data;\r\n                this.setState({currentUserId: userId});\r\n                if(this.isHaveFullAccess(userId))\r\n            {\r\n                this.setState({canShowDeleteButton: true});\r\n            }\r\n            });\r\n            \r\n        });\r\n        });\r\n\r\n        \r\n    }\r\n\r\n    isHaveFullAccess(userId){\r\n        if(userId != '' && userId == this.state.userId)\r\n            return true;\r\n        else \r\n            return false;\r\n    }\r\n\r\n    getLessonByJournal(){\r\n        let result = [];\r\n        this.state.lessons.map(lesson => {\r\n            if(lesson.journalId == this.state.id){\r\n                result.push(lesson);\r\n            }\r\n        });\r\n        return result;\r\n    }\r\n\r\n    getMarkByJournal(markId, studentId){\r\n        let result = [];\r\n        this.state.marks.map(mark => {\r\n            if(mark.journalId == markId && mark.studentId == studentId)\r\n                result.push(mark);\r\n        });\r\n        return result;\r\n    }\r\n\r\n    getAllJournalMarks(){\r\n        let result = [];\r\n        this.state.marks.map(mark => {\r\n            if(mark.journalId == this.id)\r\n                result.push(mark);\r\n        });\r\n        return result;\r\n    }\r\n\r\n    getGroupById(journalId){\r\n        let result = ''\r\n        this.state.groups.map(group => {\r\n            if(group.id == journalId)\r\n                result = group;\r\n        });\r\n        this.state.sortedGroup = result;\r\n        return result;\r\n    }\r\n\r\n    getStudentsNameByGroup(group){\r\n        let result = [];\r\n        this.state.students.map(student => {\r\n            if(student.groupId == group.id)\r\n                result.push(student);\r\n        });\r\n        this.state.sortedUsers = result;\r\n        return result;\r\n    }\r\n\r\n    changeDateHandler(event, lesson){\r\n        if(this.isHaveFullAccess(this.state.currentUserId))\r\n        lesson.date = event.target.value;\r\n        LessonService.updateLesson(lesson, lesson.id);\r\n        this.setState({});\r\n    }\r\n\r\n    changeMarkHandler(event, mark){\r\n        mark.mark = event.target.value;\r\n        MarkService.updateMark(mark, mark.id);\r\n        \r\n        this.setState({});\r\n    }\r\n\r\n    changeDescriptionHandler(event, lesson){\r\n        lesson.description = event.target.value;\r\n        LessonService.updateLesson(lesson, lesson.id);\r\n        this.setState({});\r\n    }\r\n\r\n    addMarkHandler(student){\r\n        let mark = {studentId: student.id, lessonId: '', journalId: this.state.id, mark:''};\r\n        MarkService.createMark(mark);\r\n        this.setState({});\r\n        document.location.reload();\r\n    }\r\n\r\n    addLessonHandler(){\r\n        let lesson = {description: '', date: '', journalId: this.state.id};\r\n        LessonService.createLesson(lesson).then(res => {\r\n            this.state.sortedUsers.map(student => {\r\n                let mark = {studentId: student.id, lessonId: res.data.id, journalId: this.state.id, mark:''};\r\n                MarkService.createMark(mark);\r\n            });\r\n            this.setState({});\r\n            document.location.reload();\r\n        });\r\n    }\r\n\r\n    deleteButtonHanlder(){\r\n        if(window.confirm(\"Вы действительно хотите удалить журнал?\")){\r\n            this.getAllJournalMarks().map(mark => {\r\n                MarkService.deleteMark(mark.id);\r\n            });\r\n            this.getLessonByJournal(this.state.id).map(lesson =>{\r\n                LessonService.deleteLesson(lesson.id);\r\n            });\r\n            JournalService.deleteJournal(this.state.id);\r\n        }\r\n        this.props.history.push(\"/journals\");\r\n        window.location.reload();\r\n    }\r\n\r\n    showRedactButton(){\r\n        if(AuthenticationService.isUserLoggedIn() && this.state.id != -1){\r\n            return <button onClick={(e) => this.editJournal(this.state.id)}>Изменить данные журнала</button>\r\n        }\r\n    }\r\n\r\n    showDeleteButton(){\r\n        if(this.state.canShowDeleteButton)\r\n            return <button className=\"btn btn-danger\" onClick={this.deleteButtonHanlder}>Удалить журнал</button>\r\n    }\r\n\r\n    editJournal(id){\r\n        this.props.history.push(`add-journal/${id}`);\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div>\r\n                <h2 className=\"text-center\">Список студентов</h2>\r\n                <div className=\"row\">\r\n                <div className=\"py-3\">\r\n                    {this.showRedactButton()}\r\n                    <div className=\"py-1\"></div>\r\n                    {this.showDeleteButton()}\r\n                </div>\r\n                    <table className=\"table table-striped table-bordered table-responsive\">\r\n\r\n                        <tbody>\r\n                            <tr>\r\n                                <td width=\"5%\">№</td>\r\n                                <td width=\"25%\">ФИО</td>\r\n                                {\r\n                                    this.getLessonByJournal().map(lesson => \r\n                                        <td key={lesson.id}><input value={lesson.date} onChange={(e) => {this.changeDateHandler(e, lesson)}}></input></td>)\r\n                                }\r\n                                <td onClick={this.addLessonHandler}>Добавить дату</td>\r\n                            </tr>\r\n                            {this.getStudentsNameByGroup(this.getGroupById(this.state.journal.groupId)).map((student, index) => \r\n                            <tr key={student.id}>\r\n                                <td>{index + 1}</td>\r\n                                <td>{student.firstName + \" \" + student.lastName}</td>\r\n                                {\r\n                                    this.getMarkByJournal(this.state.id, student.id).map(mark => \r\n                                        <td key={mark.id}><input value={mark.mark} onChange={(e) => {this.changeMarkHandler(e, mark)}}></input></td>)\r\n                                }\r\n                            </tr>)}\r\n                            <tr>\r\n                                <td></td>\r\n                                <td>Темы</td>\r\n                                {\r\n                                    this.getLessonByJournal().map(lesson => \r\n                                        <td key={lesson.id}><input value={lesson.description} onChange={(e) => {this.changeDescriptionHandler(e, lesson)}}></input></td>\r\n                                )}\r\n                                <td onClick={this.addLessonHandler}>Добавить тему</td>\r\n                            </tr>\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n                \r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\n\r\nexport default JournalDetailsComponent;"]},"metadata":{},"sourceType":"module"}